<!-- Chunk 1793: bytes 7468251-7470158, type=function -->
def capabilities_reward(args, pred: dspy.Prediction) -> float:
    """
    Score capabilities list quality.

    Checks:
    - Reasonable number of capabilities (2-10)
    - Each capability has name and description
    - Names are in snake_case format

    Returns:
        float: Score between 0.0 and 1.0

    """
    score = 0.0

    try:
        capabilities = getattr(pred, "capabilities", None)
        if isinstance(capabilities, str):
            try:
                capabilities = json.loads(capabilities)
            except json.JSONDecodeError:
                return 0.0

        if not isinstance(capabilities, list):
            return 0.0

        # Number of capabilities (2-10 is ideal)
        count = len(capabilities)
        if 3 <= count <= 7:
            score += 0.4
        elif 2 <= count <= 10:
            score += 0.3
        elif count >= 1:
            score += 0.1

        # Check each capability
        valid_caps = 0
        for cap in capabilities:
            if isinstance(cap, dict):
                name = cap.get("name", "")
                desc = cap.get("description", "")
            elif hasattr(cap, "name"):
                name = cap.name
                desc = getattr(cap, "description", "")
            else:
                continue

            # Name in snake_case
            if re.match(r"^[a-z][a-z0-9_]*$", name):
                valid_caps += 0.5
            # Has description
            if len(desc) > 10:
                valid_caps += 0.5

        if count > 0:
            score += (valid_caps / count) * 0.6

    except Exception as e:
        logger.warning(f"Error in capabilities_reward: {e}")
        return 0.0

    return min(score, 1.0)


# =============================================================================
# Step 4: Edit - Content Quality
# =============================================================================


