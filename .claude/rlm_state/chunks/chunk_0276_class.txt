<!-- Chunk 276: bytes 349359-351116, type=class -->
class CodeBlockExtractor(ast.NodeVisitor):
    """Extract code blocks (functions, classes, methods) from AST."""

    def __init__(self, filepath: str):
        self.filepath = filepath
        self.blocks: list[dict[str, Any]] = []

    def visit_FunctionDef(self, node: ast.FunctionDef) -> None:
        """Visit function definitions."""
        code = ast.unparse(node)
        self.blocks.append({
            "type": "function",
            "name": node.name,
            "lineno": node.lineno,
            "code": code,
            "hash": self._hash_code(code),
            "filepath": self.filepath,
        })
        self.generic_visit(node)

    def visit_AsyncFunctionDef(self, node: ast.AsyncFunctionDef) -> None:
        """Visit async function definitions."""
        code = ast.unparse(node)
        self.blocks.append({
            "type": "async_function",
            "name": node.name,
            "lineno": node.lineno,
            "code": code,
            "hash": self._hash_code(code),
            "filepath": self.filepath,
        })
        self.generic_visit(node)

    def visit_ClassDef(self, node: ast.ClassDef) -> None:
        """Visit class definitions."""
        code = ast.unparse(node)
        self.blocks.append({
            "type": "class",
            "name": node.name,
            "lineno": node.lineno,
            "code": code,
            "hash": self._hash_code(code),
            "filepath": self.filepath,
        })
        self.generic_visit(node)

    @staticmethod
    def _hash_code(code: str) -> str:
        """Generate hash of normalized code."""
        # Normalize whitespace for comparison
        normalized = " ".join(code.split())
        return hashlib.md5(normalized.encode()).hexdigest()


