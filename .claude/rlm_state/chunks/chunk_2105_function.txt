<!-- Chunk 2105: bytes 8031348-8032877, type=function -->
def test_validate_complete_blocks_metadata_symlink_escape(temp_skills_root_v1: Path) -> None:
    """Ensure metadata.json symlinks are rejected (avoid reading outside skills_root).

    Note: This test uses v1 template which requires metadata.json.
    """
    # Arrange
    validator = SkillValidator(temp_skills_root_v1)

    skill_dir = temp_skills_root_v1 / "general/symlink_metadata"
    skill_dir.mkdir(parents=True)
    for dirname in ["capabilities", "examples", "tests", "resources"]:
        (skill_dir / dirname).mkdir()

    outside_file = temp_skills_root_v1.parent / "outside-metadata.json"
    outside_file.write_text(
        json.dumps(
            {
                "skill_id": "general/symlink_metadata",
                "version": "1.0.0",
                "type": "technical",
                "weight": "lightweight",
                "load_priority": "on_demand",
                "dependencies": [],
                "capabilities": ["test"],
            }
        ),
        encoding="utf-8",
    )

    metadata_link = skill_dir / "metadata.json"
    try:
        metadata_link.symlink_to(outside_file)
    except (OSError, NotImplementedError):
        pytest.skip("Symlinks not supported in this environment")

    (skill_dir / "SKILL.md").write_text("# Test Skill\n\n## Overview\n", encoding="utf-8")

    # Act
    results = validator.validate_complete(skill_dir)

    # Assert
    assert results["passed"] is False
    assert any("metadata.json must not be a symlink" in e for e in results["errors"])


