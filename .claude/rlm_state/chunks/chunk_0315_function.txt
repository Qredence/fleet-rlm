<!-- Chunk 315: bytes 525368-526298, type=function -->
def format(
    self,
    signature: type[Signature],
    demos: list[dict[str, Any]],
    inputs: dict[str, Any],
) -> list[dict[str, Any]]:
    """
    Format inputs into multi-turn messages.

    Converts DSPy structured input along with few-shot examples and
    conversation history into multiturn messages for the LM.
    """
    # Format system message
    messages = []
    system_message = self.format_system_message(signature)
    messages.append({"role": "system", "content": system_message})

    # Format few-shot examples
    messages.extend(self.format_demos(signature, demos))

    # Format current input
    messages.append({
        "role": "user",
        "content": self.format_user_message_content(signature, inputs)
    })

    return messages
```

## Custom Adapters

### Custom Cache Key Implementation

```python
import dspy
from typing import Dict, Any, Optional
import ujson
from hashlib import sha256

