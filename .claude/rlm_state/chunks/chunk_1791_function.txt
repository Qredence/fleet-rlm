<!-- Chunk 1791: bytes 7463594-7465540, type=function -->
def taxonomy_path_reward(args, pred: dspy.Prediction) -> float:
    """
    Score taxonomy path validity and confidence.

    Checks:
    - Valid path format (lowercase, underscores, slashes)
    - Reasonable depth (2-6 levels)
    - Confidence score above threshold

    Returns:
        float: Score between 0.0 and 1.0

    """
    score = 0.0

    try:
        path = getattr(pred, "taxonomy_path", "")
        if isinstance(path, str):
            path = path.strip()

        # Valid path format (no spaces, proper separators)
        if re.match(r"^[a-z0-9_]+(/[a-z0-9_]+)*$", path):
            score += 0.4

        # Reasonable depth (2-6 levels)
        depth = len(path.split("/"))
        if 2 <= depth <= 6:
            score += 0.3
        elif depth == 1:
            score += 0.1  # Partial credit for single level

        # Starts with valid category
        valid_roots = [
            "_core",
            "technical_skills",
            "domain_knowledge",
            "tool_proficiency",
            "mcp_capabilities",
            "specializations",
            "task_focus_areas",
            "memory_blocks",
            "general",
        ]
        if path.split("/")[0] in valid_roots:
            score += 0.1

        # Confidence check
        confidence = getattr(pred, "confidence_score", 0.0)
        if isinstance(confidence, str):
            try:
                confidence = float(confidence)
            except ValueError:
                confidence = 0.0

        if confidence > 0.7:
            score += 0.2
        elif confidence > 0.5:
            score += 0.1

    except Exception as e:
        logger.warning(f"Error in taxonomy_path_reward: {e}")
        return 0.0

    return min(score, 1.0)


# =============================================================================
# Step 2: Plan - Metadata Completeness
# =============================================================================


