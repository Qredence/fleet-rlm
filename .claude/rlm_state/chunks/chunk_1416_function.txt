<!-- Chunk 1416: bytes 5164854-5168538, type=function -->
def get_settings():
    return Settings()

@app.get("/config")
async def get_config(settings: Settings = Depends(get_settings)):
    return settings.dict()
```

## File Uploads

```python
@app.post("/upload")
async def upload_file(file: UploadFile):
    # Stream the file
    df = pd.read_csv(file.file)
    return {"rows": len(df)}
```

## Background Tasks

```python
@app.post("/process")
async def start_process(background_tasks: BackgroundTasks):
    task_id = generate_task_id()
    background_tasks.add_task(long_running_task, task_id)
    return {"task_id": task_id}
```

## Common Mistakes

| Mistake | Fix |
|---------|-----|
| Engine at import time | Create in lifespan |
| Using `requests` | Use `httpx.AsyncClient` |
| Forgetting `exclude_unset=True` | Add it for PATCH |
| Sync TestClient | Use AsyncClient |
| Not disposing engine | Add `await engine.dispose()` |


============================================================
END FILE: skills/python/fastapi-production/resources/quick-reference.md
============================================================

============================================================
FILE: skills/python/fastapi-production/resources/requirements.json
============================================================

{
  "python_environment": "Python 3.8+",
  "core_libraries": [
    "fastapi>=0.128.0",
    "uvicorn[standard]>=0.23.0",
    "pydantic>=2.0.0"
  ],
  "database_libraries": [
    "sqlalchemy[asyncio]>=2.0.0",
    "asyncpg>=0.29.0"
  ],
  "testing_libraries": [
    "pytest>=7.4.0",
    "pytest-asyncio>=0.21.0",
    "httpx>=0.25.0"
  ],
  "async_libraries": [
    "aiofiles>=23.0.0",
    "aioredis>=2.0.0"
  ],
  "optional_libraries": [
    "celery[redis]>=5.3.0",
    "motor>=3.0.0"
  ],
  "tools": [
    "PostgreSQL 14+ for database examples",
    "Redis for caching/Celery examples",
    "Postman or Insomnia for API testing",
    "Web Browser for Swagger UI access",
    "fastapi-cli (included with fastapi[standard] installation)"
  ],
  "external_apis": []
}


============================================================
END FILE: skills/python/fastapi-production/resources/requirements.json
============================================================

============================================================
FILE: skills/python/fastapi-production/resources/troubleshooting.md
============================================================

# FastAPI Production Troubleshooting

## Connection Issues

### "Too many connections" database error

**Symptoms:**
- Error: `FATAL: remaining connection slots are reserved`
- Occurs under load or with multiple workers

**Causes:**
1. Engine created at import time (not in lifespan)
2. Missing `engine.dispose()` in shutdown
3. Pool parameters not configured

**Fix:**
```python
# ❌ Wrong - engine at import
engine = create_async_engine(DATABASE_URL)

# ✅ Correct - engine in lifespan
@asynccontextmanager
async def lifespan(app: FastAPI):
    engine = create_async_engine(
        DATABASE_URL,
        pool_size=10,
        max_overflow=20,
    )
    yield
    await engine.dispose()  # Critical!
```

### "Server closed the connection" unexpectedly

**Symptoms:**
- Error: `server closed the connection unexpectedly`
- Occurs after idle period

**Cause:** Database closes idle connections

**Fix:**
```python
engine = create_async_engine(
    DATABASE_URL,
    pool_recycle=3600,  # Recycle every hour
)
```

## Performance Issues

### Slow requests under load

**Symptoms:**
- Requests timeout
- High latency

**Causes:**
1. Blocking operations in async functions
2. Using `requests` library
3. Too small connection pool

**Fixes:**
```python
# ❌ Wrong - blocking
