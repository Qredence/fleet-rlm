<!-- Chunk 1388: bytes 5107682-5110309, type=class -->
class ReportResponse(BaseModel):
    total_sales: float
    average_sale: float
    transaction_count: int
    period_start: date
    period_end: date

@app.post("/reports/sales", response_model=ReportResponse)
async def generate_sales_report(
    request: ReportRequest,
    db: AsyncSession = Depends(get_db)
):
    # Async database query
    result = await db.execute(
        select(Sales).where(
            Sales.date.between(request.start_date, request.end_date)
        )
    )
    sales = result.scalars().all()

    # Calculate metrics
    total = sum(s.amount for s in sales)
    average = total / len(sales) if sales else 0

    return ReportResponse(
        total_sales=total,
        average_sale=average,
        transaction_count=len(sales),
        period_start=request.start_date,
        period_end=request.end_date
    )
```

## Best Practices

1. **Keep business logic separate**
   - Utilities in separate modules
   - Routes just handle HTTP concerns

2. **Validate early**
   - Pydantic validators for input
   - Database constraints for data integrity

3. **Return proper status codes**
   - 200: Success
   - 201: Created
   - 400: Bad request (validation error)
   - 404: Not found
   - 422: Validation error
   - 500: Server error

4. **Document with examples**
   - Pydantic `json_schema_extra` for examples
   - Auto-generated OpenAPI docs

## See Also
- [Async Conversion](async-conversion.md)
- [Pydantic Partial Updates](pydantic-partial-updates.md)
- [Request Validation](request_validation.md)


============================================================
END FILE: skills/python/fastapi-production/capabilities/python-to-api-conversion.md
============================================================

============================================================
FILE: skills/python/fastapi-production/examples/02-partial-updates/IMPLEMENTATION_SUMMARY.md
============================================================

# FastAPI PATCH Endpoint Implementation - Complete Summary

## What Was Implemented

A complete FastAPI application demonstrating a PATCH endpoint for partial user updates, including:

1. **Pydantic Models** - For user data and updates
2. **PATCH Endpoint** - Handling partial updates correctly
3. **Comprehensive Tests** - Demonstrating all scenarios
4. **Documentation** - Visual guides and detailed explanations

---

## 1. The Pydantic Model for Updates

### Location
`skills/technical_skills/programming/web_frameworks/python/fastapi/examples/patch_endpoint_example.py`

### Code
```python
from typing import Optional
from pydantic import BaseModel, EmailStr, Field

