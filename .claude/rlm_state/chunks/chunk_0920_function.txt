<!-- Chunk 920: bytes 3345185-3345945, type=function -->
def test_update_user():
    # Override dependency for test
    async def override_get_db():
        return test_session

    app.dependency_overrides[get_db] = override_get_db
    try:
        # Test with mocked DB
        response = client.patch("/users/1", json={"name": "Test"})
    finally:
        app.dependency_overrides.clear()
```

**Complex dependency graphs with yield:**
```python
async def get_db():
    async with AsyncSession(engine) as session:
        yield session
        # Automatic cleanup after response
```

### 3. Pydantic Partial Updates

**The Problem:** PATCH endpoints should only update provided fields, but naive implementations overwrite everything with `None`.

**Pattern:**

```python
from pydantic import BaseModel, Optional

