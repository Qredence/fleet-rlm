<!-- Chunk 1931: bytes 7768011-7769446, type=function -->
def generate_available_skills_xml(
    metadata_cache: dict[str, SkillMetadata],
    skills_root: Path,
    user_id: str | None = None,
) -> str:
    """
    Generate <available_skills> XML for agent context injection.

    This XML format follows the agentskills.io integration standard
    for injecting skill metadata into agent system prompts.

    Args:
        metadata_cache: Dictionary mapping skill IDs to SkillMetadata
        skills_root: Root directory of the taxonomy
        user_id: Optional user ID to filter skills (not yet implemented)

    Returns:
        XML string following agentskills.io format

    """
    xml_parts = ["<available_skills>"]

    for skill_id, meta in sorted(metadata_cache.items()):
        # Get the SKILL.md path
        if meta.path.name == "metadata.json":
            skill_md_location = meta.path.parent / "SKILL.md"
        else:
            # Single-file skill (JSON), no SKILL.md
            skill_md_location = meta.path

        # Escape XML special characters
        name = _xml_escape(meta.name or skill_id_to_name(skill_id))
        description = _xml_escape(meta.description or "")
        location = _xml_escape(str(skill_md_location))

        xml_parts.append(f"""  <skill>
    <name>{name}</name>
    <description>{description}</description>
    <location>{location}</location>
  </skill>""")

    xml_parts.append("</available_skills>")
    return "\n".join(xml_parts)


