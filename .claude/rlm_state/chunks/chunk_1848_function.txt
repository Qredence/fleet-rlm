<!-- Chunk 1848: bytes 7632414-7635215, type=function -->
def drop_db() -> None:
    """
    Drop all database tables.

    WARNING: This will delete all data!
    """
    # Drop dependent views/materialized views first
    with engine.connect() as conn:
        conn.execute(text("DROP MATERIALIZED VIEW IF EXISTS skill_statistics CASCADE"))
        conn.execute(text("DROP VIEW IF EXISTS popular_skills_view CASCADE"))
        conn.execute(text("DROP VIEW IF EXISTS skills_attention_view CASCADE"))
        conn.execute(text("DROP VIEW IF EXISTS active_skills_view CASCADE"))
        conn.execute(text("DROP VIEW IF EXISTS draft_skills_view CASCADE"))

        # Manually drop all known tables in dependency order with CASCADE
        tables_to_drop = [
            "optimization_jobs",
            "usage_events",
            "skill_test_coverage",
            "validation_checks",
            "validation_reports",
            "tdd_workflow_state",
            "deep_understanding_state",
            "hitl_interactions",
            "jobs",
            "skill_allowed_tools",
            "skill_files",
            "tag_stats",
            "skill_tags",
            "skill_keywords",
            "skill_references",
            "dependency_closure",
            "skill_dependencies",
            "capabilities",
            "facet_definitions",
            "skill_facets",
            "skill_aliases",
            "skill_categories",
            "taxonomy_closure",
            "taxonomy_categories",
            "skills",
        ]

        for table in tables_to_drop:
            conn.execute(text(f"DROP TABLE IF EXISTS {table} CASCADE"))

        # Drop types
        types_to_drop = [
            "skill_status_enum",
            "skill_type_enum",
            "skill_weight_enum",
            "load_priority_enum",
            "skill_style_enum",
            "dependency_type_enum",
            "job_status_enum",
            "hitl_type_enum",
            "validation_status_enum",
            "severity_enum",
            "file_type_enum",
        ]

        for type_name in types_to_drop:
            conn.execute(text(f"DROP TYPE IF EXISTS {type_name} CASCADE"))

        conn.commit()

    Base.metadata.drop_all(bind=engine)


async def init_async_db() -> None:
    """
    Initialize the async database by creating all tables.

    This should only be used for development. In production,
    use Alembic migrations instead.
    """
    async with async_engine.begin() as conn:
        await conn.execute(text('CREATE EXTENSION IF NOT EXISTS "uuid-ossp"'))
        await conn.run_sync(Base.metadata.create_all)


async def drop_async_db() -> None:
    """
    Drop all async database tables.

    WARNING: This will delete all data!
    """
    async with async_engine.begin() as conn:
        await conn.run_sync(Base.metadata.drop_all)


