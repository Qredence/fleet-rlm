<!-- Chunk 1496: bytes 6336211-6338945, type=function -->
def _register_exception_handlers(app: FastAPI) -> None:
    """
    Register global exception handlers for consistent error responses.

    Args:
        app: FastAPI application instance

    """

    @app.exception_handler(SkillFleetAPIError)
    async def skill_fleet_exception_handler(
        request: Request, exc: SkillFleetAPIError
    ) -> JSONResponse:
        """Handle custom Skill Fleet exceptions."""
        request_id = getattr(request.state, "request_id", "unknown")
        logger.warning(
            f"[{request_id}] {exc.__class__.__name__}: {exc.detail}",
            extra={
                "request_id": request_id,
                "exception_type": exc.__class__.__name__,
                "status_code": exc.status_code,
            },
        )

        content = {"error": exc.detail, "request_id": request_id}
        if hasattr(exc, "extra") and exc.extra:
            content.update(exc.extra)  # type: ignore[no-untyped-call]

        return JSONResponse(
            status_code=exc.status_code,
            content=content,
            headers=exc.headers,
        )

    @app.exception_handler(StarletteHTTPException)
    async def http_exception_handler(request: Request, exc: StarletteHTTPException) -> JSONResponse:
        """Handle standard HTTP exceptions."""
        request_id = getattr(request.state, "request_id", "unknown")
        logger.warning(
            f"[{request_id}] HTTPException: {exc.detail}",
            extra={
                "request_id": request_id,
                "status_code": exc.status_code,
            },
        )

        return JSONResponse(
            status_code=exc.status_code,
            content={"error": exc.detail, "request_id": request_id},
        )

    @app.exception_handler(RequestValidationError)
    async def validation_exception_handler(
        request: Request, exc: RequestValidationError
    ) -> JSONResponse:
        """Handle Pydantic validation errors."""
        request_id = getattr(request.state, "request_id", "unknown")
        logger.warning(
            f"[{request_id}] Validation error: {exc.errors()}",
            extra={
                "request_id": request_id,
                "validation_errors": exc.errors(),
            },
        )

        return JSONResponse(
            status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
            content={
                "error": "Validation error",
                "details": exc.errors(),
                "request_id": request_id,
            },
        )


# Lazy app initialization to allow environment variables to be set before import
# This is important for testing where conftest.py sets SKILL_FLEET_ENV and SKILL_FLEET_CORS_ORIGINS
_app: FastAPI | None = None


