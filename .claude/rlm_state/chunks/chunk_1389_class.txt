<!-- Chunk 1389: bytes 5110309-5114829, type=class -->
class UserUpdate(BaseModel):
    """
    Model for partial user updates.

    KEY FEATURE: All fields are Optional, allowing partial updates.
    """
    name: Optional[str] = Field(None, min_length=1, max_length=100)
    email: Optional[EmailStr] = None
    age: Optional[int] = Field(None, ge=0, le=150)
```

### Why This Works
- **All fields are `Optional[T]`** - Clients can omit any field
- **Default value `None`** - Unprovided fields default to None
- **Validation preserved** - Fields still validated when provided

---

## 2. The PATCH Endpoint Implementation

### Location
Same file as above

### Code
```python
from fastapi import FastAPI, HTTPException, status

@app.patch("/users/{user_id}", response_model=User)
async def update_user(user_id: int, user_update: UserUpdate):
    """
    PATCH endpoint for partial user updates.

    KEY FEATURES:
    1. Only updates fields that are provided in the request
    2. Ignores fields that are None (not provided)
    3. Preserves existing values for fields not in the request
    """
    if user_id not in fake_db:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"User with id {user_id} not found"
        )

    # Get the existing user
    existing_user = fake_db[user_id]

    # Get the update data as a dictionary, excluding None values
    # This is the key to partial updates!
    update_data = user_update.model_dump(exclude_unset=True)

    # If no fields were provided, return the user unchanged
    if not update_data:
        return existing_user

    # Update only the fields that were provided
    # The ** operator unpacks the dictionary as keyword arguments
    updated_user = existing_user.model_copy(update=update_data)

    # Save to "database"
    fake_db[user_id] = updated_user

    return updated_user
```

### Key Mechanisms

1. **`model_dump(exclude_unset=True)`**
   - Returns only fields that were explicitly set in the request
   - Excludes fields that weren't provided (not just None values)
   - Example: `{"name": "John"}` → `{"name": "John"}` (not `{"name": "John", "email": None, "age": None}`)

2. **`model_copy(update=...)`**
   - Creates a new Pydantic model instance
   - Only updates fields specified in the update dict
   - Preserves existing values for all other fields
   - Immutable: doesn't modify the original object

3. **Empty check (`if not update_data`)**
   - Returns early if no fields provided
   - Avoids unnecessary database operations
   - Returns user unchanged

---

## 3. How It Handles Different Scenarios

### Scenario 1: Update Only Name
**Request:**
```bash
curl -X PATCH http://localhost:8000/users/1 \\
  -H "Content-Type: application/json" \\
  -d '{"name": "John Updated"}'
```

**Result:**
```json
{
  "id": 1,
  "name": "John Updated",        // CHANGED
  "email": "john@example.com",   // UNCHANGED
  "age": 30                      // UNCHANGED
}
```

**What happens:**
1. Pydantic parses: `UserUpdate(name="John Updated", email=None, age=None)`
2. `exclude_unset=True` → `{"name": "John Updated"}`
3. `model_copy(update={"name": "John Updated"})`
4. Only name is updated, other fields preserved

### Scenario 2: Update Multiple Fields
**Request:**
```bash
curl -X PATCH http://localhost:8000/users/1 \\
  -H "Content-Type: application/json" \\
  -d '{"name": "John", "age": 35}'
```

**Result:**
```json
{
  "id": 1,
  "name": "John",                // CHANGED
  "email": "john@example.com",   // UNCHANGED
  "age": 35                      // CHANGED
}
```

### Scenario 3: Empty Request
**Request:**
```bash
curl -X PATCH http://localhost:8000/users/1 \\
  -H "Content-Type: application/json" \\
  -d '{}'
```

**Result:**
- User returned unchanged
- Early return from empty check
- No database write

---

## 4. Testing

### Run Tests
```bash
# Navigate to the examples directory from the repository root
cd skills/technical_skills/programming/web_frameworks/python/fastapi/examples

uv run python test_patch_endpoint.py
```

### Test Coverage
- ✅ Partial update (name only)
- ✅ Partial update (age only)
- ✅ Partial update (multiple fields)
- ✅ Empty update (no fields)
- ✅ Full update (all fields)
- ✅ Pydantic `exclude_unset=True` demonstration
- ✅ Pydantic `model_copy(update=...)` demonstration

### Run Visual Guide
```bash
uv run python visual_guide.py
```

Shows step-by-step flow of how partial updates work.

---

## 5. Key Takeaways

### Essential Pattern for PATCH Endpoints

```python
# 1. Update model with all Optional fields
