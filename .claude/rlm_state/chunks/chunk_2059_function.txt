<!-- Chunk 2059: bytes 7964272-7965272, type=function -->
def test_analytics_engine(temp_analytics_dir):
    tracker = UsageTracker(temp_analytics_dir)
    tracker.track_usage("skill_1", "user_1", success=True, task_id="task_1")
    tracker.track_usage("skill_2", "user_1", success=True, task_id="task_1")
    tracker.track_usage("skill_1", "user_1", success=True, task_id="task_2")
    tracker.track_usage("skill_1", "user_2", success=True, task_id="task_3")

    engine = AnalyticsEngine(temp_analytics_dir / "usage_log.jsonl")

    # Global stats
    stats = engine.analyze_usage()
    assert stats["total_events"] == 4
    assert stats["unique_skills_used"] == 2
    assert stats["most_used_skills"][0] == ("skill_1", 3)

    # User specific stats
    user1_stats = engine.analyze_usage("user_1")
    assert user1_stats["total_events"] == 3

    # Combinations
    assert len(stats["common_combinations"]) == 1
    assert set(stats["common_combinations"][0]["skills"]) == {"skill_1", "skill_2"}
    assert stats["common_combinations"][0]["count"] == 1


