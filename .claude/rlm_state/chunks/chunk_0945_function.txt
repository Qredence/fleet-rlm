<!-- Chunk 945: bytes 3409852-3410635, type=function -->
def validate_path_within_root(user_path: Path, root_path: Path, path_type: str = "Path") -> Path:
    """Validate that a user-provided path is within the allowed root directory.

    Args:
        user_path: The path provided by the user.
        root_path: The allowed root directory.
        path_type: Description of the path type for error messages.

    Returns:
        The resolved absolute path if valid.

    Raises:
        ValueError: If the path would escape the root directory.
    """
    user_path = user_path.resolve()
    root_path = root_path.resolve()

    try:
        user_path.relative_to(root_path)
        return user_path
    except ValueError:
        raise ValueError(
            f"{path_type} path '{user_path}' must be within '{root_path}'"
        )


