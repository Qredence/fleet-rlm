<!-- Chunk 2122: bytes 8048100-8048556, type=function -->
def test_auto_approval_handler_requests_revision_on_failure() -> None:
    handler = AutoApprovalHandler()
    feedback = handler.get_feedback(
        packaging_manifest="{}",
        validation_report={"passed": False, "status": "failed", "errors": ["e1", "e2", "e3", "e4"]},
    )

    data = json.loads(feedback)
    assert data["status"] == "needs_revision"
    assert "Validation errors" in data["comments"]
    assert data["reviewer"] == "system"


