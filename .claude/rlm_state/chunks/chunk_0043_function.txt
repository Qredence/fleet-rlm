<!-- Chunk 43: bytes 119375-122321, type=function -->
def test_reward_function():
    class Args:
        expected = "Brussels"
        context = "Capital of Belgium"

    class Pred:
        answer = "Paris"

    pred = Pred()
    score = exact_match_reward(Args(), pred)
    assert score == 0.0  # Should fail for wrong answer

test_reward_function()
```

## Common Issues and Solutions

### Issue: All Candidates Fail Threshold

**Problem**: No candidate meets threshold, returns best (or last) candidate

**Solution**:
1. Lower threshold
2. Increase N (more candidates)
3. Improve reward function
4. Check if task is feasible

### Issue: Refine Doesn't Improve

**Problem**: Refine iterations don't improve output

**Solution**:
1. Check reward function provides useful feedback
2. Improve feedback generation in Refine
3. Increase N (more attempts)
4. Try different module or signature

### Issue: Slow Refinement

**Problem**: BestOfN or Refine takes too long

**Solution**:
1. Reduce N (fewer candidates/iterations)
2. Use simpler base module (without ChainOfThought)
3. Cache expensive reward function calculations
4. Parallelize BestOfN candidates

### Issue: Reward Function Biases Output

**Problem**: Reward function leads to biased or unexpected outputs

**Solution**:
1. Review reward function for unintended incentives
2. Add multiple criteria
3. Test with diverse examples
4. Use human evaluation samples


============================================================
END FILE: .fleet/factory/skills/dspy-advanced/references/output-refinement.md
============================================================

============================================================
FILE: .fleet/factory/skills/dspy-advanced/references/react-tools.md
============================================================

# DSPy ReAct Agents and Tools

ReAct combines reasoning and action, enabling agents to use tools to answer complex questions. This guide covers ReAct agent patterns and tool integration.

## Table of Contents

- [ReAct Overview](#react-overview)
- [Basic ReAct Agent](#basic-react-agent)
- [Tool Definition](#tool-definition)
- [Multi-Tool Coordination](#multi-tool-coordination)
- [Tool Error Handling](#tool-error-handling)
- [Best Practices](#best-practices)

## ReAct Overview

### What is ReAct?

ReAct (Reasoning + Acting) is an agent pattern that combines language model reasoning with the ability to use external tools. It follows a loop of:
1. **Reason**: Analyze the current state and decide on next action
2. **Act**: Call a tool or provide the final answer
3. **Observe**: Update state with tool results

### Why Use ReAct?

- **Complex tasks**: Questions requiring multiple steps and tools
- **External knowledge**: Access to APIs, databases, search engines
- **Dynamic reasoning**: Adapt to intermediate results
- **Traceability**: Full trajectory of tool calls for debugging

## Basic ReAct Agent

### Simple ReAct with Single Tool

```python
import dspy

# Define tool
