<!-- Chunk 1380: bytes 5103366-5105528, type=class -->
class PaymentResponse(BaseModel):
    status: str
    transaction_id: str
```

**3. Make Async**
```python
# utils/payment.py (async version)
async def process_payment_async(
    user_id: int,
    amount: float,
    card: CreditCard,
    db: AsyncSession
) -> str:
    # Async database call
    user = await db.get(User, user_id)

    if user.balance < amount:
        raise ValueError("Insufficient funds")

    # Async payment gateway
    transaction_id = await payment_gateway.charge_async(card, amount)

    return transaction_id
```

**4. Create FastAPI Endpoint**
```python
# routes/payments.py
from fastapi import HTTPException, Depends

@app.post("/payments", response_model=PaymentResponse)
async def payment_endpoint(
    request: PaymentRequest,
    db: AsyncSession = Depends(get_db)
):
    # Validate user exists
    user = await db.get(User, request.user_id)
    if not user:
        raise HTTPException(
            status_code=404,
            detail="User not found"
        )

    # Check balance
    if user.balance < request.amount:
        raise HTTPException(
            status_code=400,
            detail="Insufficient funds"
        )

    # Process payment
    try:
        transaction_id = await process_payment_async(
            request.user_id,
            request.amount,
            request.card,
            db
        )
    except PaymentGatewayError as e:
        raise HTTPException(
            status_code=502,
            detail=f"Payment gateway error: {str(e)}"
        )

    return PaymentResponse(
        status="success",
        transaction_id=transaction_id
    )
```

## Conversion Checklist

| Step | What to Do | Why |
|------|------------|-----|
| 1. Add Pydantic models | Create Request/Response models | Automatic validation |
| 2. Make async | Add async/await for I/O operations | Non-blocking |
| 3. Replace exceptions | Use HTTPException with status codes | Proper HTTP responses |
| 4. Add response_model | Specify return model in decorator | Output validation |
| 5. Use dependencies | Replace globals with Depends() | Testability |

## Common Conversions

### Sync Database â†’ Async
```python
# Before
