<!-- Chunk 1944: bytes 7795986-7798243, type=function -->
def resolve_skill_location(
    skill_identifier: str,
    skills_root: Path,
    index: TaxonomyIndex,
) -> str:
    """
    Resolve a skill identifier (ID, path, or alias) to its canonical storage path.

    This implements the polyfill strategy:
    1. Check Index (canonical ID or alias).
    2. Fallback to Filesystem (legacy support).

    Args:
        skill_identifier: The skill ID, path, or alias to resolve
        skills_root: Root directory of the taxonomy
        index: Taxonomy index containing canonical paths and aliases

    Returns:
        Canonical storage path for the skill

    Raises:
        FileNotFoundError: If skill cannot be found in index or filesystem

    """
    # 1. Check Index direct match
    if skill_identifier in index.skills:
        return index.skills[skill_identifier].canonical_path

    # 1b. Check Index aliases
    for skill_id, entry in index.skills.items():
        if skill_identifier in entry.aliases:
            logger.warning(
                f"Deprecation Warning: Accessing skill via alias '{skill_identifier}'. "
                f"Use canonical ID '{skill_id}' instead."
            )
            return entry.canonical_path

    # 2. Filesystem Fallback
    # Check if the identifier looks like a valid path that exists on disk
    safe_path = sanitize_taxonomy_path(skill_identifier)
    if safe_path:
        full_path = resolve_path_within_root(skills_root, safe_path)

        # Check directory-style skill
        if full_path.exists() and (full_path / "metadata.json").exists():
            if "_drafts" not in safe_path:
                logger.warning(
                    f"Legacy Access: Skill '{skill_identifier}' found on disk (dir) but missing from Taxonomy Index."
                )
            return safe_path

        # Check single-file skill
        json_path = full_path.with_suffix(".json")
        if json_path.exists():
            if "_drafts" not in safe_path:
                logger.warning(
                    f"Legacy Access: Skill '{skill_identifier}' found on disk (json) but missing from Taxonomy Index."
                )
            return safe_path

    # Not found
    raise FileNotFoundError(f"Skill '{skill_identifier}' not found in index or filesystem.")


