<!-- Chunk 1953: bytes 7813083-7820560, type=function -->
def write_extra_files(skill_dir: Path, extra_files: dict[str, Any]) -> None:
    """
    Populate skill subdirectories with additional content.

    Only creates directories when there is actual content to write.

    Args:
        skill_dir: Path to the skill directory
        extra_files: Dictionary mapping file categories to content

    """
    # Handle capability implementations
    if "capability_implementations" in extra_files:
        caps = extra_files["capability_implementations"]
        if isinstance(caps, str) and caps.strip().startswith(("{", "[")):
            try:
                caps = json.loads(caps)
            except json.JSONDecodeError:
                pass

        if isinstance(caps, dict):
            caps_dir = skill_dir / "references" / "capability-implementations"
            caps_dir.mkdir(parents=True, exist_ok=True)
            for cap_id, cap_content in caps.items():
                raw_name = f"{str(cap_id).replace('/', '_')}.md"
                filename = raw_name if is_safe_path_component(raw_name) else "implementation.md"
                (caps_dir / filename).write_text(str(cap_content), encoding="utf-8")
        else:
            refs_dir = skill_dir / "references"
            refs_dir.mkdir(exist_ok=True)
            (refs_dir / "capability-implementations.md").write_text(str(caps), encoding="utf-8")

    # Handle usage examples
    if "usage_examples" in extra_files:
        examples = extra_files["usage_examples"]
        if isinstance(examples, str) and examples.strip().startswith(("{", "[")):
            try:
                examples = json.loads(examples)
            except json.JSONDecodeError:
                pass

        if isinstance(examples, list):
            examples_dir = skill_dir / "examples"
            examples_dir.mkdir(exist_ok=True)
            for i, example in enumerate(examples):
                if isinstance(example, dict):
                    content = example.get("code") or example.get("content")
                    if content:
                        ext = ".py" if "code" in example else ".md"
                        suggested = str(example.get("filename", "")).strip()
                        default_name = f"example_{i + 1}{ext}"
                        filename = (
                            suggested
                            if suggested and is_safe_path_component(suggested)
                            else default_name
                        )
                    else:
                        suggested = str(example.get("filename", "")).strip()
                        default_name = f"example_{i + 1}.json"
                        filename = (
                            suggested
                            if suggested and is_safe_path_component(suggested)
                            else default_name
                        )
                        content = json.dumps(example, indent=2)
                else:
                    filename = f"example_{i + 1}.md"
                    content = str(example)
                (examples_dir / filename).write_text(content, encoding="utf-8")
        else:
            examples_dir = skill_dir / "examples"
            examples_dir.mkdir(exist_ok=True)
            (examples_dir / "examples.md").write_text(str(examples), encoding="utf-8")

    # Handle tests
    if "integration_tests" in extra_files:
        tests = extra_files["integration_tests"]
        if isinstance(tests, str) and tests.strip().startswith(("{", "[")):
            try:
                tests = json.loads(tests)
            except json.JSONDecodeError:
                pass

        if isinstance(tests, list):
            tests_dir = skill_dir / "tests"
            tests_dir.mkdir(exist_ok=True)
            for i, test in enumerate(tests):
                if isinstance(test, dict):
                    content = test.get("code") or test.get("content")
                    if content:
                        ext = ".py" if "code" in test else ".md"
                        suggested = str(test.get("filename", "")).strip()
                        default_name = f"test_{i + 1}{ext}"
                        filename = (
                            suggested
                            if suggested and is_safe_path_component(suggested)
                            else default_name
                        )
                    else:
                        suggested = str(test.get("filename", "")).strip()
                        default_name = f"test_{i + 1}.json"
                        filename = (
                            suggested
                            if suggested and is_safe_path_component(suggested)
                            else default_name
                        )
                        content = json.dumps(test, indent=2)
                else:
                    filename = f"test_{i + 1}.py"
                    content = str(test)
                (tests_dir / filename).write_text(content, encoding="utf-8")
        else:
            tests_dir = skill_dir / "tests"
            tests_dir.mkdir(exist_ok=True)
            (tests_dir / "test_skill.py").write_text(str(tests), encoding="utf-8")

    # Handle best practices
    if "best_practices" in extra_files and extra_files["best_practices"]:
        bp = extra_files["best_practices"]
        if isinstance(bp, str) and bp.strip().startswith("["):
            try:
                bp_list = json.loads(bp)
                content = "## Best Practices\n\n" + "\n".join([f"- {item}" for item in bp_list])
            except (json.JSONDecodeError, TypeError):
                content = str(bp)
        else:
            content = str(bp)
        (skill_dir / "best_practices.md").write_text(content, encoding="utf-8")

    # Handle integration guide
    if "integration_guide" in extra_files and extra_files["integration_guide"]:
        guide = extra_files["integration_guide"]
        (skill_dir / "integration.md").write_text(str(guide), encoding="utf-8")

    # Handle resource requirements
    if "resource_requirements" in extra_files and extra_files["resource_requirements"]:
        res = extra_files["resource_requirements"]
        guides_dir = skill_dir / "guides"
        guides_dir.mkdir(exist_ok=True)
        filename = (
            "requirements.json"
            if isinstance(res, (dict, list))
            or (isinstance(res, str) and res.strip().startswith(("{", "[")))
            else "requirements.md"
        )
        (guides_dir / filename).write_text(str(res), encoding="utf-8")

    # Handle bundled resources
    for category in ["scripts", "assets", "resources"]:
        if category in extra_files:
            items = extra_files[category]
            if isinstance(items, dict):
                target_dir = skill_dir / ("guides" if category == "resources" else category)
                target_dir.mkdir(parents=True, exist_ok=True)
                for filename, content in items.items():
                    sanitized = sanitize_relative_file_path(str(filename))
                    if sanitized is None:
                        continue
                    file_path = resolve_path_within_root(target_dir, sanitized)
                    file_path.parent.mkdir(parents=True, exist_ok=True)
                    if isinstance(content, bytes):
                        file_path.write_bytes(content)
                    else:
                        file_path.write_text(str(content), encoding="utf-8")


