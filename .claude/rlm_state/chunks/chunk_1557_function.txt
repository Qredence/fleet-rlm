<!-- Chunk 1557: bytes 6417601-6420433, type=function -->
def cleanup_old_sessions(max_age_hours: float = 24.0) -> int:
    """
    Clean up old session files and evict from memory.

    Args:
        max_age_hours: Maximum age in hours before deletion

    Returns:
        Number of sessions cleaned up

    """
    cleaned = 0
    cutoff_time = time.time() - (max_age_hours * 3600)

    # Clean up files
    try:
        for session_file in SESSION_DIR.glob("*.json"):
            if session_file.stat().st_mtime < cutoff_time:
                try:
                    session_file.unlink()
                    cleaned += 1
                except Exception:
                    # Ignore errors when deleting individual files
                    pass
    except Exception:
        # Ignore errors during cleanup (e.g., directory doesn't exist)
        pass

    # Also trigger memory eviction
    JOBS._evict_if_needed()

    if cleaned > 0:
        logger.info(f"Cleaned up {cleaned} old session(s)")

    return cleaned


============================================================
END FILE: src/skill_fleet/api/services/jobs.py
============================================================

============================================================
FILE: src/skill_fleet/api/services/skill_service.py
============================================================

"""
FastAPI service layer for skill creation operations.

This service bridges FastAPI routes to the skill creation workflow orchestrators.
It provides a clean API for skill creation, validation, and refinement operations.

The service layer handles:
- Creating skills from natural language descriptions
- Managing skill creation jobs (async background tasks)
- Saving skills to draft area
- Retrieving skill metadata
- Validating and refining skills
- Hierarchical MLflow tracking with parent runs and child runs for each phase

This service uses the workflows layer orchestrators for clean separation of concerns.
"""

from __future__ import annotations

import logging
import uuid
from typing import TYPE_CHECKING, Any

from skill_fleet.core.workflows.skill_creation.generation import GenerationWorkflow
from skill_fleet.core.workflows.skill_creation.understanding import UnderstandingWorkflow
from skill_fleet.core.workflows.skill_creation.validation import ValidationWorkflow
from skill_fleet.infrastructure.tracing.mlflow import (
    end_parent_run,
    log_quality_metrics,
    log_skill_artifacts,
    log_tags,
    log_validation_results,
    start_child_run,
    start_parent_run,
)
from skill_fleet.taxonomy.manager import TaxonomyManager

from ...core.models import SkillCreationResult
from ..schemas.models import JobState
from .job_manager import get_job_manager

logger = logging.getLogger(__name__)

if TYPE_CHECKING:
    from pathlib import Path

    from ..schemas.skills import CreateSkillRequest


