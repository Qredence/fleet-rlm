<!-- Chunk 1231: bytes 4623330-4625518, type=function -->
def main():
    """Main execution entry point."""
    root = Path(__file__).parents[1]
    report_path = root / "reports/taxonomy-map.md"
    index_path = root / "skills/taxonomy_index.json"

    if not report_path.exists():
        logging.error("Error: %s not found", report_path)
        return

    print("Parsing mapping...")
    content = report_path.read_text(encoding="utf-8")
    mapping_data = parse_markdown_table(content)

    print(f"Found {len(mapping_data)} skills")

    # Build Skills Inventory
    skills_inventory = {}
    for item in mapping_data:
        # Determine taxonomy location (dot notation) from canonical path
        # e.g. python/async -> python.async
        # NOTE: If canonical path is "python/async", "async" is the folder name.
        # The logic taxonomy location might be just "python".
        parts = item["canonical_path"].split("/")
        location = ".".join(parts[:-1]) if len(parts) > 1 else "root"

        entry = SkillEntry(
            canonical_path=item["canonical_path"],
            taxonomy_location=location,
            aliases=[item["current_path"]],  # The legacy path is the alias
            facets=item["facets"],
            status="active",
        )
        skills_inventory[item["skill_id"]] = entry

    # Build Logical Tree
    taxonomy_tree = build_taxonomy_tree(mapping_data)

    # Construct Full Index
    index = TaxonomyIndex(version="1.0.0", taxonomy_tree=taxonomy_tree, skills=skills_inventory)

    print("Writing index...")
    index_path.write_text(index.model_dump_json(indent=2), encoding="utf-8")
    print(f"Success! Written to {index_path}")


if __name__ == "__main__":
    main()


============================================================
END FILE: scripts/internal/db/generate_taxonomy_index.py
============================================================

============================================================
FILE: scripts/internal/db/migrate_skills_structure.py
============================================================

"""Migrate skill directories to their new canonical paths based on taxonomy_index.json."""

import json
import logging
import shutil
from pathlib import Path


