<!-- Chunk 2089: bytes 8012183-8013800, type=class -->
class TestChooseWithOther:
    @pytest.mark.asyncio
    async def test_choose_one_with_other_triggers_free_text(self):
        # Arrange
        class _FakeUI:
            async def ask_text(self, _prompt: str, *, default: str = "") -> str:
                return "my free text"

            async def choose_one(self, _prompt: str, _choices, *, default_id=None):
                return OTHER_OPTION_ID

            async def choose_many(self, _prompt: str, _choices, *, default_ids=None):
                raise AssertionError("not used")

        # Act
        selected, free_text = await choose_one_with_other(
            cast("PromptUI", _FakeUI()),
            "Pick one",
            [("a", "A"), ("b", "B")],
        )

        # Assert
        assert selected == []
        assert free_text == "my free text"

    @pytest.mark.asyncio
    async def test_choose_many_with_other_includes_ids_and_free_text(self):
        # Arrange
        class _FakeUI:
            async def ask_text(self, _prompt: str, *, default: str = "") -> str:
                return "extra"

            async def choose_one(self, _prompt: str, _choices, *, default_id=None):
                raise AssertionError("not used")

            async def choose_many(self, _prompt: str, _choices, *, default_ids=None):
                return ["a", OTHER_OPTION_ID]

        # Act
        selected, free_text = await choose_many_with_other(
            cast("PromptUI", _FakeUI()),
            "Pick many",
            [("a", "A"), ("b", "B")],
        )

        # Assert
        assert selected == ["a"]
        assert free_text == "extra"


