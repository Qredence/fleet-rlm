<!-- Chunk 1495: bytes 6334948-6336211, type=function -->
def create_app() -> FastAPI:
    """
    Create and configure the FastAPI application.

    Returns:
        FastAPI: The configured application instance.

    """
    # Configure logging
    _configure_logging()

    # Configure DSPy globally for the API
    try:
        configure_dspy()
        logger.info("DSPy configured successfully")
    except Exception as e:
        logger.error(f"Failed to configure DSPy: {e}")

    app = FastAPI(
        title=settings.api_title,
        description=settings.api_description,
        version=settings.api_version,
        lifespan=lifespan,
    )

    # Configure middleware (order matters)
    _configure_middleware(app)

    # Configure CORS (security validation)
    _configure_cors(app)

    # Register exception handlers
    _register_exception_handlers(app)

    # Include v1 API router (the only API version)
    from .v1.router import router as v1_router

    app.include_router(v1_router, prefix="/api/v1", tags=["v1-api"])

    @app.get("/health")
    async def health():
        """
        Health check endpoint to verify API availability.

        Returns:
            dict: Status and version information

        """
        return {"status": "ok", "version": settings.api_version}

    return app


